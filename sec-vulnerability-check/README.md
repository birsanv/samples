# Scripts Directory

This directory contains utility scripts for the cluster-backup-operator project.

## 🔍 Vulnerability Scanner (`vuln-check.sh`)

A comprehensive vulnerability scanning script that uses `govulncheck` to identify security issues in Go dependencies and code. Features a beautiful summary table that clearly categorizes vulnerabilities by source (Go standard library vs third-party dependencies).

### Quick Start

```bash
# Install govulncheck and run all scans
./scripts/vuln-check.sh -i && ./scripts/vuln-check.sh -a

# Quick module scan (recommended for CI)
./scripts/vuln-check.sh -m

# Detailed symbol scan with verbose output
./scripts/vuln-check.sh -s -v
```

### Available Options

| Option | Description |
|--------|-------------|
| `-h, --help` | Show help message |
| `-m, --module` | Fast scan of dependencies only |
| `-s, --symbol` | Detailed scan checking actual usage |
| `-b, --binary` | Scan compiled binary (requires build) |
| `-v, --verbose` | Show verbose output |
| `-a, --all` | Run all scan types |
| `-i, --install` | Install/update govulncheck tool |

### Scan Types

1. **Module Scan** (`-m`) - Fast dependency scan
   - Scans `go.mod` for known vulnerabilities
   - Fastest option for CI/CD pipelines
   - Shows all vulnerabilities in dependencies

2. **Symbol Scan** (`-s`) - Detailed usage analysis
   - Checks if vulnerable code is actually called
   - More accurate but slower
   - Best for development and pre-release checks

3. **Binary Scan** (`-b`) - Compiled binary analysis
   - Scans the built `bin/manager` binary
   - Most accurate for production deployments
   - Automatically builds binary if needed

### 📊 Sample Output

The script provides a comprehensive vulnerability analysis with a clear summary table:

```
=== Vulnerability Analysis by Source ===
🔴 Go Standard Library Vulnerabilities: 9
   Source: Your Go version (go.mod requirement)
   Fix: Update Go to latest patch version

🟡 Third-party Dependencies: 2
   Source: External packages in go.mod
   Fix: Update specific dependency versions

Vulnerable dependencies:
   • golang.org/x/net@v0.36.0

📊 Vulnerability Summary Table:
┌───────────────────────────┬───────┬────────────────┬──────────────┐
│ Source                    │ Count │ Status         │ Action       │
├───────────────────────────┼───────┼────────────────┼──────────────┤
│ Go Standard Library       │ 9     │ 🔴 NeedsUpdate │ Update Go    │
│ Third-party Dependencies  │ 2     │ 🟡 NeedsUpdate │ go get -u    │
├───────────────────────────┼───────┼────────────────┼──────────────┤
│ TOTAL VULNERABILITIES     │ 10    │ ⚠️ ActionNeeded │ See below    │
└───────────────────────────┴───────┴────────────────┴──────────────┘

🥉 Security Score: NEEDS ATTENTION (10 total vulnerabilities)
   Dependencies need updates: 2 vulnerabilities
```

**Security Scores:**
- 🏆 **EXCELLENT** (0 vulnerabilities) - Perfect security
- 🥈 **GOOD** (stdlib only) - Great dependency management  
- 🥉 **NEEDS ATTENTION** - Action required for dependencies

### Integration Examples

#### GitHub Actions
```yaml
- name: Vulnerability Check
  run: ./scripts/vuln-check.sh -m
```

#### Pre-commit Hook
```bash
#!/bin/sh
./scripts/vuln-check.sh -m || exit 1
```

#### Makefile Integration
```makefile
.PHONY: vuln-check
vuln-check:
	./scripts/vuln-check.sh -m

.PHONY: vuln-check-verbose
vuln-check-verbose:
	./scripts/vuln-check.sh -a -v
```

### Exit Codes

- `0` - No vulnerabilities found
- `1` - Script error or vulnerabilities found
- `2` - Symbol scan found vulnerabilities
- `3` - Module scan found vulnerabilities

### Common Issues

**govulncheck not found:**
```bash
./scripts/vuln-check.sh -i  # Install the tool
```

**Internal errors:**
- Update Go to latest patch version
- Clear module cache: `go clean -modcache`

**Binary not found:**
- Script will automatically run `make build`
- Ensure project builds successfully first

### Security Workflow

1. **Daily/Weekly**: `./scripts/vuln-check.sh -m`
2. **Pre-release**: `./scripts/vuln-check.sh -a -v`
3. **After Go updates**: `./scripts/vuln-check.sh -s`
4. **CI Pipeline**: `./scripts/vuln-check.sh -m`

### Related Links

- [govulncheck documentation](https://pkg.go.dev/golang.org/x/vuln/cmd/govulncheck)
- [Go vulnerability database](https://pkg.go.dev/vuln/)
- [Security advisories](https://github.com/golang/vulndb) 